@page "/magasin"
@using QueteDuDragon.Data
@inject EtatJeu EtatJeu
@inject NavigationManager Navigation

@if (EtatJeu.SelectedHero == null)
{
    <p>Erreur : Le héros ou l'état du jeu n'a pas été initialisé. Veuillez revenir en arrière et réessayer.</p>
    <button @onclick="Retourner">Retour</button>
}
else
{
    <h3>Magasin</h3>
    <p>Bienvenue, @EtatJeu.SelectedHero.Name ! Vous pouvez acheter des objets en fonction de votre niveau.</p>
    <p>Niveau actuel : @EtatJeu.SelectedHero.Level</p>
    <p>Objets que vous pouvez acheter : @EtatJeu.SelectedHero.AllowedPurchases</p>

    <div>
        @foreach (var item in MagasinObjets)
        {
            <button @onclick="() => AcheterObjet(item)" disabled="@EtatJeu.ObjetsCollectes.Contains(item)">
                @item
            </button>
        }
    </div>

    <p><strong>Objets collectés par ce héros :</strong></p>
    @if (EtatJeu.ObjetsCollectes.Any())
    {
        <ul>
            @foreach (var item in EtatJeu.ObjetsCollectes)
            {
                <li>@item</li>
            }
        </ul>
    }
    else
    {
        <p>Aucun objet collecté pour ce héros.</p>
    }

    <button @onclick="Retourner">Retour</button>
}

@code {

    private readonly List<string> MagasinObjets = new()
    {
        "Épée à deux mains", "Hache de guerre", "Arc long", "Dague", "Marteau de guerre",
        "Armure de plaque", "Bouclier enchanté", "Potion de soins", "Potion de force",
        "Potion de vitesse", "Pierre de téléportation", "Sceau de protection", "Anneau de résistance",
        "Amulette de protection", "Potion de soins universelle", "Pierre philosophale (fragment)",
        "Carte du monde détaillée", "Boussole magique", "Miroir magique", "Kit de survie"
    };

    private void AcheterObjet(string objet)
    {
        if (EtatJeu.ObjetsCollectes.Count < EtatJeu.SelectedHero?.AllowedPurchases)
        {
            EtatJeu.AjouterObjetCollecte(objet);
        }
    }

    private void Retourner()
    {
        Navigation.NavigateTo(EtatJeu.SelectedMode == "Facile" ? "/mode-facile" : "/mode-difficile");
    }

}